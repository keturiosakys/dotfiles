set -g default-terminal "xterm-256color"
#set -g default-terminal "screen-256color"
set -ga terminal-overrides ",*:Tc"
#set -ga terminal-overrides ',*:Ss=\E[%p1%d q:Se=\E[2 q'
set -ga terminal-overrides ",alacritty:Tc"

set -g default-command /opt/homebrew/bin/fish

set -s escape-time 0
set -g mouse on
setw -g automatic-rename on   # rename window to reflect current program
set -g renumber-windows on    # renumber windows when a window is closed
set -g set-titles on          # set terminal title

# Prefix key
unbind C-b
set-option -g prefix C-x
bind-key C-x send-prefix
set -g base-index 1
setw -g pane-base-index 1

bind w choose-tree -swZ
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
bind P paste-buffer
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"

# reload config file (change file location to your the tmux.conf you want to use)
#bind r source-file ~/.config/tmux/tmux.conf; display "Tmux config reloaded!"
bind i run-shell "tmux neww ~/.config/tmux/scripts/cht.sh"
bind t run-shell "tmux neww ~/.config/tmux/scripts/tldr.sh"
bind o run-shell "tmux neww ~/.config/tmux/scripts/man.sh"

# KEYBINDS
# unbinds
unbind n
unbind c
unbind [
unbind ]
unbind '"'
unbind %
unbind Up
unbind Right
unbind Down
unbind Left
unbind z

# binds
bind -r g display-popup -d "#{pane_current_path}" -w 95% -h 90% -E "lazygit"
bind C new-window /opt/homebrew/bin/nu
bind N new-window /opt/homebrew/bin/nu
bind n new-window -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"
bind-key x kill-pane
bind [ previous-window
bind ] next-window
bind y copy-mode

bind v split-window -h -c "#{pane_current_path}"
bind s split-window -v -c "#{pane_current_path}"

bind h select-pane -L
bind l select-pane -R
bind j select-pane -D
bind k select-pane -U

bind L select-window -t :+
bind H select-window -t :-

# Join panes
bind m select-pane -m # mark
bind M select-pane -M # unmark

bind J join-pane

bind 0 select-window -t 0

#is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
#    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
#bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h'  'select-pane -L'
#bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j'  'select-pane -D'
#bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k'  'select-pane -U'
#bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l'  'select-pane -R'
#tmux_version='$(tmux -V | sed -En "s/^tmux ([0-9]+(.[0-9]+)?).*/\1/p")'
#if-shell -b '[ "$(echo "$tmux_version < 3.0" | bc)" = 1 ]' \
#    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\'  'select-pane -l'"
#if-shell -b '[ "$(echo "$tmux_version >= 3.0" | bc)" = 1 ]' \
#    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\\\'  'select-pane -l'"
#
#bind-key -T copy-mode-vi 'C-h' select-pane -L
#bind-key -T copy-mode-vi 'C-j' select-pane -D
#bind-key -T copy-mode-vi 'C-k' select-pane -U
#bind-key -T copy-mode-vi 'C-l' select-pane -R


# arrows for resizing panes
bind -r Up resize-pane -U 5
bind -r Right resize-pane -R 5
bind -r Down resize-pane -D 5
bind -r Left resize-pane -L
bind -r Enter resize-pane -Z

# Ctrl + Shift + Arrows for moving tabs
bind -r < swap-window -t -1\; select-window -t -1
bind -r > swap-window -t +1\; select-window -t +1

bind-key -r f run-shell "tmux neww ~/.config/tmux/scripts/tmux-sessionizer"
bind Tab last-window        # move to last active window

# Theme config
rose_pine_bg="#191724"
rose_pine_text="#eaf2f1"
rose_pine_muted="#9893a5"
rose_pine_subtle="#797593"
set-option -g status-style fg="$rose_pine_text",bg="$rose_pine_bg"
set-option -g status-position bottom
set-window-option -g status-justify left
#set -g status-left " #[fg=$rose_pine_subtle] #[fg=$rose_pine_subtle]#S "
set -g status-left " "
#set -g status-left-length 100 

set -g status-interval 0
set -g status-right '   #(pwd | sed "s#$HOME#~#") %b-%d %H:%M '
set -g status-right-length 100 

set-option -g automatic-rename on
#rename_format="ps -o comm= -p #{pane_pid} | sed -E 's/(.*)/\\1/'"
set-option -g automatic-rename-format "#{pane_current_command}"

setw -g window-status-format "#[fg=$rose_pine_subtle][ #I:#W ]"
setw -g window-status-current-format "[ #I:#W#{?window_zoomed_flag,↕ , }]"

# Plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'fcsonline/tmux-thumbs'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'


# Thumbs config
set -g @thumbs-alphabet qwerty
set -g @thumbs-contrast 1
set -g @thumbs-position left
set -g @thumbs-hint-fg-color yellow
set -g @thumbs-command 'echo -n {} | pbcopy'

set -g @thumbs-regexp-1 '[A-Za-z0-9-_]{22}' # Fiberplane IDs
set -g @thumbs-regexp-2 '[A-Za-z]{1,}-[A-Za-z]{1,}' # Fiberplane names
#



run '~/.config/tmux/plugins/tpm/tpm'

run-shell ~/.config/tmux/plugins/tmux-thumbs/tmux-thumbs.tmux
